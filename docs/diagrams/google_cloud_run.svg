<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2110" height="770" viewBox="0 0 1055 385"><defs><style type="text/css">@import url(https://fonts.googleapis.com/css?family=Roboto);</style><marker id="path-arrow-start" markerHeight="6" markerWidth="7" orient="auto" refX="7" refY="3"><path d="M0,3 L7,0 V6 Z" style="fill:#3a7df0"/></marker><marker id="path-arrow-end" markerHeight="6" markerWidth="7" orient="auto" refX="0" refY="3"><path d="M0,0 V6 L7,3 Z" style="fill:#3a7df0"/></marker><filter id="drop-shadow"><feGaussianBlur in="SourceAlpha" result="baseShadow" stdDeviation="0.7 0.7"/><feOffset dx="0" dy="1" in="baseShadow" result="offsetBlur"/><feFlood flood-color="rgba(0,0,0,0.3)" flood-fill-opacity="0" in="baseShadow" result="shadowColor"/><feComposite in="offsetBlur" in2="shadowColor" k1="0" k2="0" k3="0" k4="0" operator="in" result="dropShadow"/><feMerge><feMergeNode in="dropShadow"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><desc># Generated by go/gcpdraw meta { title &quot;Exposure Notification Key Server&quot; } elements { ######################################## # Clients and Partners ######################################## # In card smartphone as client card server as federated_ingestion_server # Out card smartphone as out_client card server as federated_partner gcp { ######################################## # Compute Components ######################################## card cloud_run as tek_ingestion { name &quot;Temporary Exposure Key (TEK) Ingestion&quot; description &quot;Intake of Temporary Exposure Keys&quot; } card cloud_run as federated_ingestion { name &quot;Federated Ingestion&quot; description &quot;Federated Ingestion&quot; } card cloud_run as data_deletion { name &quot;Data Deletion&quot; description &quot;Periodically delete old Temporary Exposure Keys&quot; } card cloud_run as federation_api { name &quot;Federated Access&quot; description &quot;&quot; } card cloud_run as batch_keys { name &quot;Batch Temporary Exposure Keys&quot; description &quot;&quot; } ######################################## # Storage Components ######################################## card sql { name &quot;Temporary Exposure Keys Database&quot; description &quot;&quot; } card storage as storage { name &quot;Batches&quot; description &quot;&quot; } card cdn # Likely needed instead of CDN for non-gcp # card cloud_run as cdn { # name &quot;Temporary Exposure Keys Batch Server&quot; #} card secret_manager as secret_manager { name &quot;Certificates, Keys } ######################################## # ######################################## card cloud_scheduler { name &quot;Periodically run Data Deletion, Batching&quot; } } } paths { federated_ingestion_server --&gt; federated_ingestion client --&gt; tek_ingestion tek_ingestion --&gt; sql federated_ingestion --&gt; sql data_deletion --&gt; sql sql --&gt; batch_keys sql --&gt; federation_api batch_keys --&gt; storage storage --&gt; cdn federation_api --&gt; federated_partner cdn --&gt; out_client # Don&apos;t render connections as it clutters diagram # cloud_scheduler ..&gt; data_deletion # cloud_scheduler ..&gt; batch_keys }</desc><rect width="1055" height="20" x="0" y="0" style="fill:#519bf7;filter:url(#drop-shadow)"/><text x="24" y="13" style="font-family:Roboto;font-size:8.5px;fill:#fff">Exposure Notification Key Server</text><rect width="1055" height="10" x="0" y="375" style="fill:#e0e0e0"/><rect width="40" height="40" x="15" y="147" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="34" height="34" x="18" y="150" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/phone.png"/><rect width="40" height="40" x="15" y="207" style="stroke-Width:.06;filter:url(#drop-shadow);fill:#fff;stroke:#000"/><image width="34" height="34" x="18" y="210" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/server.png"/><rect width="40" height="40" x="1000" y="147" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="34" height="34" x="1003" y="150" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/phone.png"/><rect width="40" height="40" x="1000" y="207" style="stroke:#000;stroke-Width:.06;filter:url(#drop-shadow);fill:#fff"/><image width="34" height="34" x="1003" y="210" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/server.png"/><rect width="885" height="325" x="85" y="30" style="fill:#f6f6f6"/><image width="80" height="30" x="95" y="40" xlink:href="https://storage.googleapis.com/gcpdraw-icons/others/google_cloud_logo.png"/><rect width="203" height="45" x="100" y="70" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="75" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/run.png"/><text x="132" y="77" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Temporary Exposure Key (TEK) Ingestion</text><text x="132" y="87" style="fill:#757575;dominant-baseline:text-before-edge;font-family:Roboto;font-size:7px">Cloud Run</text><line x1="132" x2="198" y1="98" y2="98" style="stroke:#e0e0e0;stroke-Width:.8"/><text x="132" y="101" style="font-family:Roboto;font-size:6.5px;fill:#000;dominant-baseline:text-before-edge">Intake of Temporary Exposure Keys</text><rect width="117" height="45" x="100" y="135" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="140" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/run.png"/><text x="132" y="142" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Federated Ingestion</text><text x="132" y="152" style="font-size:7px;fill:#757575;dominant-baseline:text-before-edge;font-family:Roboto">Cloud Run</text><line x1="132" x2="198" y1="163" y2="163" style="stroke:#e0e0e0;stroke-Width:.8"/><text x="132" y="166" style="fill:#000;dominant-baseline:text-before-edge;font-family:Roboto;font-size:6.5px">Federated Ingestion</text><rect width="210" height="45" x="100" y="200" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="205" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/run.png"/><text x="132" y="207" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Data Deletion</text><text x="132" y="217" style="dominant-baseline:text-before-edge;font-family:Roboto;font-size:7px;fill:#757575">Cloud Run</text><line x1="132" x2="198" y1="228" y2="228" style="stroke:#e0e0e0;stroke-Width:.8"/><text x="132" y="231" style="font-family:Roboto;font-size:6.5px;fill:#000;dominant-baseline:text-before-edge">Periodically delete old Temporary Exposure Keys</text><rect width="109" height="30" x="548" y="167" style="stroke:#000;stroke-Width:.06;filter:url(#drop-shadow);fill:#fff"/><image width="20" height="20" x="553" y="172" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/run.png"/><text x="580" y="174" style="fill:#212121;dominant-baseline:text-before-edge;font-family:Roboto;font-size:7.5px">Federated Access</text><text x="580" y="184" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">Cloud Run</text><rect width="162" height="30" x="548" y="217" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="553" y="222" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/run.png"/><text x="580" y="224" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Batch Temporary Exposure Keys</text><text x="580" y="234" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">Cloud Run</text><rect width="176" height="30" x="342" y="192" style="filter:url(#drop-shadow);fill:#fff;stroke:#000;stroke-Width:.06"/><image width="20" height="20" x="347" y="197" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/sql.png"/><text x="374" y="199" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Temporary Exposure Keys Database</text><text x="374" y="209" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">Cloud SQL</text><rect width="109" height="30" x="740" y="192" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="745" y="197" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/storage.png"/><text x="772" y="199" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Batches</text><text x="772" y="209" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">Cloud Storage</text><rect width="75" height="30" x="880" y="192" style="stroke:#000;stroke-Width:.06;filter:url(#drop-shadow);fill:#fff"/><image width="20" height="20" x="885" y="197" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/cdn.png"/><text x="912" y="199" style="font-size:7px;fill:#757575;dominant-baseline:text-before-edge;font-family:Roboto">Cloud</text><text x="912" y="207" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">CDN</text><rect width="113" height="30" x="100" y="265" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="270" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/secret_manager.png"/><text x="132" y="272" style="font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge;font-family:Roboto">Certificates, Keys</text><text x="132" y="282" style="fill:#757575;dominant-baseline:text-before-edge;font-family:Roboto;font-size:7px">Secret Manager</text><rect width="212" height="30" x="100" y="315" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="320" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/v2/scheduler.png"/><text x="132" y="322" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Periodically run Data Deletion, Batching</text><text x="132" y="332" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">Cloud Scheduler</text><polyline points="55 227 77 227 77 157 93 157" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="55 167 77 167 77 92 93 92" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="303 92 322 92 322 207 335 207" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="217 157 279 157 279 207 335 207" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="310 222 326 222 326 207 335 207" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="518 207 533 207 533 232 541 232" style="stroke:#3a7df0;marker-end:url(#path-arrow-end);fill:none"/><polyline points="518 207 533 207 533 182 541 182" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="710 232 725 232 725 207 733 207" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="850 207 865 207 865 207 873 207" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="657 182 828 182 828 227 993 227" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="955 207 977 207 977 167 993 167" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/></svg>