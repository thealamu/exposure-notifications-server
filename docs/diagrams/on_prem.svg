<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1730" height="710" viewBox="0 0 865 355"><defs><style type="text/css">@import url(https://fonts.googleapis.com/css?family=Roboto);</style><marker id="path-arrow-start" markerHeight="6" markerWidth="7" orient="auto" refX="7" refY="3"><path d="M0,3 L7,0 V6 Z" style="fill:#3a7df0"/></marker><marker id="path-arrow-end" markerHeight="6" markerWidth="7" orient="auto" refX="0" refY="3"><path d="M0,0 V6 L7,3 Z" style="fill:#3a7df0"/></marker><filter id="drop-shadow"><feGaussianBlur in="SourceAlpha" result="baseShadow" stdDeviation="0.7 0.7"/><feOffset dx="0" dy="1" in="baseShadow" result="offsetBlur"/><feFlood flood-color="rgba(0,0,0,0.3)" flood-fill-opacity="0" in="baseShadow" result="shadowColor"/><feComposite in="offsetBlur" in2="shadowColor" k1="0" k2="0" k3="0" k4="0" operator="in" result="dropShadow"/><feMerge><feMergeNode in="dropShadow"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><desc># Generated by go/gcpdraw meta { title &quot;Exposure Notification Key Server&quot; } elements { ######################################## # Clients and Partners ######################################## # In card smartphone as client card server as federated_ingestion_server # Out card smartphone as out_client card server as federated_partner group OnPrem { ######################################## # Compute Components ######################################## card gke_onprem as tracing_key_ingestion { name &quot;Exposure Key Ingestion&quot; description &quot;Intake of Exposure Keys&quot; } card gke_onprem as federated_ingestion { name &quot;Federated Ingestion&quot; description &quot;Federated Ingestion&quot; } card gke_onprem as data_deletion { name &quot;Data Deletion&quot; description &quot;Periodically delete old exposure keys&quot; } card gke_onprem as federation_api { name &quot;Federated Access&quot; description &quot;&quot; } card gke_onprem as batch_keys { name &quot;Batch Exposure Keys&quot; description &quot;&quot; } ######################################## # Storage Components ######################################## card server as sql { name &quot;Database&quot; } card server as storage { name &quot;Batches&quot; description &quot;&quot; } card gke_onprem as secret_manager { name &quot;Secret Manager&quot; } #card cdn # Likely needed instead of CDN card gke_onprem as cdn { name &quot;Exposure Key Batch Server&quot; } ######################################## # ######################################## card gke_onprem as cloud_scheduler { name &quot;Periodically run Data Deletion, Batching&quot; } } } paths { federated_ingestion_server --&gt; federated_ingestion client --&gt; tracing_key_ingestion tracing_key_ingestion --&gt; sql federated_ingestion --&gt; sql data_deletion ..&gt; sql sql --&gt; batch_keys sql --&gt; federation_api batch_keys --&gt; storage storage --&gt; cdn federation_api --&gt; federated_partner cdn --&gt; out_client # Don&apos;t render connections as it clutters diagram # cloud_scheduler ..&gt; data_deletion # cloud_scheduler ..&gt; batch_keys }</desc><rect width="865" height="20" x="0" y="0" style="filter:url(#drop-shadow);fill:#519bf7"/><text x="24" y="13" style="font-family:Roboto;font-size:8.5px;fill:#fff">Exposure Notification Key Server</text><rect width="865" height="10" x="0" y="345" style="fill:#e0e0e0"/><rect width="40" height="40" x="15" y="132" style="stroke:#000;stroke-Width:.06;filter:url(#drop-shadow);fill:#fff"/><image width="34" height="34" x="18" y="135" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/phone.png"/><rect width="40" height="40" x="15" y="192" style="filter:url(#drop-shadow);fill:#fff;stroke:#000;stroke-Width:.06"/><image width="34" height="34" x="18" y="195" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/server.png"/><rect width="40" height="40" x="810" y="132" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="34" height="34" x="813" y="135" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/phone.png"/><rect width="40" height="40" x="810" y="192" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="34" height="34" x="813" y="195" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/server.png"/><rect width="695" height="305" x="85" y="30" style="fill:#e3f2fd"/><text x="90" y="40" style="font-family:Roboto;font-size:7.5px;fill:#9e9e9e;dominant-baseline:central">OnPrem</text><rect width="126" height="45" x="100" y="50" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="55" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="132" y="57" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Exposure Key Ingestion</text><text x="132" y="67" style="fill:#757575;dominant-baseline:text-before-edge;font-family:Roboto;font-size:7px">GKE On-Prem</text><line x1="132" x2="198" y1="78" y2="78" style="stroke:#e0e0e0;stroke-Width:.8"/><text x="132" y="81" style="dominant-baseline:text-before-edge;font-family:Roboto;font-size:6.5px;fill:#000">Intake of Exposure Keys</text><rect width="117" height="45" x="100" y="115" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="120" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="132" y="122" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Federated Ingestion</text><text x="132" y="132" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">GKE On-Prem</text><line x1="132" x2="198" y1="143" y2="143" style="stroke:#e0e0e0;stroke-Width:.8"/><text x="132" y="146" style="font-family:Roboto;font-size:6.5px;fill:#000;dominant-baseline:text-before-edge">Federated Ingestion</text><rect width="172" height="45" x="100" y="180" style="stroke-Width:.06;filter:url(#drop-shadow);fill:#fff;stroke:#000"/><image width="20" height="20" x="105" y="185" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="132" y="187" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Data Deletion</text><text x="132" y="197" style="dominant-baseline:text-before-edge;font-family:Roboto;font-size:7px;fill:#757575">GKE On-Prem</text><line x1="132" x2="198" y1="208" y2="208" style="stroke:#e0e0e0;stroke-Width:.8"/><text x="132" y="211" style="font-family:Roboto;font-size:6.5px;fill:#000;dominant-baseline:text-before-edge">Periodically delete old exposure keys</text><rect width="109" height="30" x="412" y="147" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="417" y="152" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="444" y="154" style="font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge;font-family:Roboto">Federated Access</text><text x="444" y="164" style="dominant-baseline:text-before-edge;font-family:Roboto;font-size:7px;fill:#757575">GKE On-Prem</text><rect width="113" height="30" x="412" y="197" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="417" y="202" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="444" y="204" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Batch Exposure Keys</text><text x="444" y="214" style="font-size:7px;fill:#757575;dominant-baseline:text-before-edge;font-family:Roboto">GKE On-Prem</text><rect width="40" height="55" x="342" y="160" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="34" height="34" x="345" y="163" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/server.png"/><text x="347" y="202" style="font-size:7px;fill:#000;dominant-baseline:central;font-family:Roboto">Database</text><rect width="40" height="55" x="555" y="160" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="34" height="34" x="558" y="163" xlink:href="https://storage.googleapis.com/gcpdraw-icons/user/server.png"/><text x="560" y="202" style="font-family:Roboto;font-size:7px;fill:#000;dominant-baseline:central">Batches</text><rect width="109" height="30" x="100" y="245" style="fill:#fff;stroke:#000;stroke-Width:.06;filter:url(#drop-shadow)"/><image width="20" height="20" x="105" y="250" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="132" y="252" style="fill:#212121;dominant-baseline:text-before-edge;font-family:Roboto;font-size:7.5px">Secret Manager</text><text x="132" y="262" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">GKE On-Prem</text><rect width="140" height="30" x="625" y="172" style="stroke-Width:.06;filter:url(#drop-shadow);fill:#fff;stroke:#000"/><image width="20" height="20" x="630" y="177" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="657" y="179" style="font-family:Roboto;font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge">Exposure Key Batch Server</text><text x="657" y="189" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">GKE On-Prem</text><rect width="212" height="30" x="100" y="295" style="stroke-Width:.06;filter:url(#drop-shadow);fill:#fff;stroke:#000"/><image width="20" height="20" x="105" y="300" xlink:href="https://storage.googleapis.com/gcpdraw-icons/product/gke_onprem.png"/><text x="132" y="302" style="font-size:7.5px;fill:#212121;dominant-baseline:text-before-edge;font-family:Roboto">Periodically run Data Deletion, Batching</text><text x="132" y="312" style="font-family:Roboto;font-size:7px;fill:#757575;dominant-baseline:text-before-edge">GKE On-Prem</text><polyline points="55 212 77 212 77 137 93 137" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="55 152 77 152 77 72 93 72" style="stroke:#3a7df0;marker-end:url(#path-arrow-end);fill:none"/><polyline points="226 72 284 72 284 187 335 187" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="217 137 279 137 279 187 335 187" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="272 202 307 202 307 187 335 187" style="fill:none;stroke:#3a7df0;marker-end:url(#path-arrow-end);stroke-dasharray:1,2"/><polyline points="382 187 397 187 397 212 405 212" style="fill:none;stroke:#3a7df0;marker-end:url(#path-arrow-end)"/><polyline points="382 187 397 187 397 162 405 162" style="fill:none;stroke:#3a7df0;marker-end:url(#path-arrow-end)"/><polyline points="525 212 540 212 540 187 548 187" style="stroke:#3a7df0;marker-end:url(#path-arrow-end);fill:none"/><polyline points="595 187 610 187 610 187 618 187" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="521 162 665 162 665 212 803 212" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/><polyline points="765 187 787 187 787 152 803 152" style="marker-end:url(#path-arrow-end);fill:none;stroke:#3a7df0"/></svg>